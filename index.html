<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Bottle Feed Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Quicksand', 'Nunito', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 50%, #a29bfe 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 20px;
            color: #5f5f5f;
            position: relative;
            overflow-x: hidden;
        }

        .cloud {
            position: fixed;
            opacity: 0.5;
            animation: float linear infinite;
            pointer-events: none;
        }

        /* Create realistic fluffy clouds with multiple overlapping circles */
        .cloud > div {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
        }

        /* Cloud 1 - 5 puffs for realistic shape */
        .cloud1 {
            width: 100px;
            height: 40px;
            top: 10%;
            left: -100px;
            animation-duration: 45s;
            animation-delay: 0s;
        }

        .cloud1 > div:nth-child(1) { width: 40px; height: 40px; bottom: 0; left: 0; }
        .cloud1 > div:nth-child(2) { width: 50px; height: 50px; bottom: 10px; left: 20px; }
        .cloud1 > div:nth-child(3) { width: 45px; height: 45px; bottom: 12px; left: 40px; }
        .cloud1 > div:nth-child(4) { width: 38px; height: 38px; bottom: 5px; left: 60px; }
        .cloud1 > div:nth-child(5) { width: 35px; height: 35px; bottom: 0; right: 0; }

        /* Cloud 2 - 6 puffs */
        .cloud2 {
            width: 80px;
            height: 35px;
            top: 25%;
            left: -80px;
            animation-duration: 55s;
            animation-delay: 5s;
        }

        .cloud2 > div:nth-child(1) { width: 32px; height: 32px; bottom: 0; left: 0; }
        .cloud2 > div:nth-child(2) { width: 42px; height: 42px; bottom: 8px; left: 15px; }
        .cloud2 > div:nth-child(3) { width: 38px; height: 38px; bottom: 10px; left: 30px; }
        .cloud2 > div:nth-child(4) { width: 35px; height: 35px; bottom: 9px; left: 45px; }
        .cloud2 > div:nth-child(5) { width: 30px; height: 30px; bottom: 3px; right: 8px; }
        .cloud2 > div:nth-child(6) { width: 28px; height: 28px; bottom: 0; right: 0; }

        /* Cloud 3 - 7 puffs (biggest cloud) */
        .cloud3 {
            width: 120px;
            height: 45px;
            top: 50%;
            left: -120px;
            animation-duration: 50s;
            animation-delay: 10s;
        }

        .cloud3 > div:nth-child(1) { width: 42px; height: 42px; bottom: 0; left: 0; }
        .cloud3 > div:nth-child(2) { width: 52px; height: 52px; bottom: 10px; left: 18px; }
        .cloud3 > div:nth-child(3) { width: 48px; height: 48px; bottom: 14px; left: 38px; }
        .cloud3 > div:nth-child(4) { width: 50px; height: 50px; bottom: 12px; left: 55px; }
        .cloud3 > div:nth-child(5) { width: 45px; height: 45px; bottom: 8px; left: 70px; }
        .cloud3 > div:nth-child(6) { width: 40px; height: 40px; bottom: 3px; right: 10px; }
        .cloud3 > div:nth-child(7) { width: 35px; height: 35px; bottom: 0; right: 0; }

        /* Cloud 4 - 5 puffs */
        .cloud4 {
            width: 90px;
            height: 38px;
            top: 70%;
            left: -90px;
            animation-duration: 60s;
            animation-delay: 15s;
        }

        .cloud4 > div:nth-child(1) { width: 36px; height: 36px; bottom: 0; left: 0; }
        .cloud4 > div:nth-child(2) { width: 46px; height: 46px; bottom: 9px; left: 18px; }
        .cloud4 > div:nth-child(3) { width: 42px; height: 42px; bottom: 11px; left: 35px; }
        .cloud4 > div:nth-child(4) { width: 38px; height: 38px; bottom: 7px; left: 52px; }
        .cloud4 > div:nth-child(5) { width: 34px; height: 34px; bottom: 0; right: 0; }

        /* Cloud 5 - 6 puffs */
        .cloud5 {
            width: 110px;
            height: 42px;
            top: 85%;
            left: -110px;
            animation-duration: 48s;
            animation-delay: 20s;
        }

        .cloud5 > div:nth-child(1) { width: 40px; height: 40px; bottom: 0; left: 0; }
        .cloud5 > div:nth-child(2) { width: 48px; height: 48px; bottom: 10px; left: 20px; }
        .cloud5 > div:nth-child(3) { width: 46px; height: 46px; bottom: 12px; left: 40px; }
        .cloud5 > div:nth-child(4) { width: 42px; height: 42px; bottom: 10px; left: 58px; }
        .cloud5 > div:nth-child(5) { width: 38px; height: 38px; bottom: 5px; right: 12px; }
        .cloud5 > div:nth-child(6) { width: 35px; height: 35px; bottom: 0; right: 0; }

        /* Cloud 6 - 5 puffs */
        .cloud6 {
            width: 95px;
            height: 40px;
            top: 15%;
            left: -95px;
            animation-duration: 52s;
            animation-delay: 25s;
        }

        .cloud6 > div:nth-child(1) { width: 38px; height: 38px; bottom: 0; left: 0; }
        .cloud6 > div:nth-child(2) { width: 48px; height: 48px; bottom: 9px; left: 19px; }
        .cloud6 > div:nth-child(3) { width: 44px; height: 44px; bottom: 11px; left: 38px; }
        .cloud6 > div:nth-child(4) { width: 40px; height: 40px; bottom: 6px; left: 55px; }
        .cloud6 > div:nth-child(5) { width: 36px; height: 36px; bottom: 0; right: 0; }

        /* Cloud 7 - 6 puffs */
        .cloud7 {
            width: 105px;
            height: 43px;
            top: 35%;
            left: -105px;
            animation-duration: 58s;
            animation-delay: 30s;
        }

        .cloud7 > div:nth-child(1) { width: 40px; height: 40px; bottom: 0; left: 0; }
        .cloud7 > div:nth-child(2) { width: 50px; height: 50px; bottom: 10px; left: 20px; }
        .cloud7 > div:nth-child(3) { width: 46px; height: 46px; bottom: 12px; left: 40px; }
        .cloud7 > div:nth-child(4) { width: 44px; height: 44px; bottom: 11px; left: 58px; }
        .cloud7 > div:nth-child(5) { width: 38px; height: 38px; bottom: 5px; right: 10px; }
        .cloud7 > div:nth-child(6) { width: 35px; height: 35px; bottom: 0; right: 0; }

        /* Cloud 8 - 7 puffs */
        .cloud8 {
            width: 115px;
            height: 44px;
            top: 60%;
            left: -115px;
            animation-duration: 53s;
            animation-delay: 35s;
        }

        .cloud8 > div:nth-child(1) { width: 40px; height: 40px; bottom: 0; left: 0; }
        .cloud8 > div:nth-child(2) { width: 50px; height: 50px; bottom: 10px; left: 18px; }
        .cloud8 > div:nth-child(3) { width: 48px; height: 48px; bottom: 13px; left: 36px; }
        .cloud8 > div:nth-child(4) { width: 46px; height: 46px; bottom: 12px; left: 52px; }
        .cloud8 > div:nth-child(5) { width: 44px; height: 44px; bottom: 9px; left: 68px; }
        .cloud8 > div:nth-child(6) { width: 38px; height: 38px; bottom: 4px; right: 10px; }
        .cloud8 > div:nth-child(7) { width: 35px; height: 35px; bottom: 0; right: 0; }

        /* Cloud 9 - 5 puffs */
        .cloud9 {
            width: 88px;
            height: 37px;
            top: 78%;
            left: -88px;
            animation-duration: 56s;
            animation-delay: 40s;
        }

        .cloud9 > div:nth-child(1) { width: 35px; height: 35px; bottom: 0; left: 0; }
        .cloud9 > div:nth-child(2) { width: 45px; height: 45px; bottom: 8px; left: 17px; }
        .cloud9 > div:nth-child(3) { width: 42px; height: 42px; bottom: 10px; left: 34px; }
        .cloud9 > div:nth-child(4) { width: 38px; height: 38px; bottom: 6px; left: 50px; }
        .cloud9 > div:nth-child(5) { width: 34px; height: 34px; bottom: 0; right: 0; }

        /* Cloud 10 - 6 puffs */
        .cloud10 {
            width: 100px;
            height: 41px;
            top: 92%;
            left: -100px;
            animation-duration: 54s;
            animation-delay: 45s;
        }

        .cloud10 > div:nth-child(1) { width: 38px; height: 38px; bottom: 0; left: 0; }
        .cloud10 > div:nth-child(2) { width: 48px; height: 48px; bottom: 9px; left: 18px; }
        .cloud10 > div:nth-child(3) { width: 45px; height: 45px; bottom: 11px; left: 36px; }
        .cloud10 > div:nth-child(4) { width: 42px; height: 42px; bottom: 9px; left: 52px; }
        .cloud10 > div:nth-child(5) { width: 38px; height: 38px; bottom: 4px; right: 10px; }
        .cloud10 > div:nth-child(6) { width: 35px; height: 35px; bottom: 0; right: 0; }

        @keyframes float {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(calc(100vw + 200px));
            }
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .main-header {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            font-size: 36px;
            font-weight: 800;
            text-shadow: 0 4px 12px rgba(0,0,0,0.2);
            letter-spacing: -0.5px;
        }

        .main-header::before {
            content: 'ðŸ‘¶ ';
        }

        .main-header::after {
            content: ' ðŸŒŸ';
        }

        .section-title {
            color: white;
            text-align: center;
            margin-bottom: 20px;
            margin-top: 30px;
            font-size: 24px;
            font-weight: 700;
            text-shadow: 0 2px 8px rgba(0,0,0,0.15);
            letter-spacing: 0.3px;
        }

        .section-title::before {
            content: 'ðŸ¼ ';
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 32px;
            font-weight: 700;
            text-shadow: 0 3px 10px rgba(0,0,0,0.15);
            letter-spacing: 0.5px;
        }

        h1::before {
            content: 'ðŸ¼ ';
        }

        h1::after {
            content: ' ðŸ¼';
        }

        .record-section {
            background: linear-gradient(135deg, #ffffff 0%, #fef9f9 100%);
            border-radius: 25px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(162, 155, 254, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.8);
        }

        h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #a29bfe;
            font-size: 20px;
            font-weight: 700;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5px;
            border-radius: 15px;
            overflow: hidden;
        }

        .history-table thead tr {
            background: linear-gradient(135deg, #fdcb6e 0%, #fab1a0 100%);
            color: white;
        }

        .history-table thead th {
            padding: 14px 10px;
            font-size: 14px;
            font-weight: 700;
            text-align: center;
            letter-spacing: 0.5px;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .history-table thead th:first-child {
            text-align: left;
            border-radius: 15px 0 0 0;
        }

        .history-table thead th:last-child {
            border-radius: 0 15px 0 0;
        }

        .history-table tbody tr {
            border-bottom: 2px solid #fef5f5;
            transition: background 0.2s;
        }

        .history-table tbody tr:last-child {
            border-bottom: none;
        }

        .history-table tbody tr:hover {
            background: linear-gradient(135deg, #fff5f7 0%, #fef9f9 100%);
        }

        .history-table tbody td {
            padding: 14px 10px;
            font-size: 15px;
            text-align: center;
            color: #6c5ce7;
        }

        .history-table tbody td:first-child {
            text-align: left;
            font-weight: 700;
            color: #a29bfe;
            font-size: 14px;
        }

        .history-table .total-ml {
            font-weight: 700;
            color: #fd79a8;
            font-size: 17px;
        }

        .history-table .feed-count {
            color: #74b9ff;
            font-size: 15px;
            font-weight: 600;
        }

        .history-empty {
            text-align: center;
            color: #dfe6e9;
            font-size: 14px;
            padding: 8px 0;
            font-style: italic;
        }

        .manual-entry-grid {
            display: flex;
            gap: 12px;
            margin-bottom: 18px;
        }

        .manual-entry-grid input {
            flex: 2;
            padding: 16px;
            border: 2px solid #ffe5ec;
            border-radius: 15px;
            font-size: 17px;
            background: #fff5f7;
            color: #6c5ce7;
            font-weight: 600;
            transition: border-color 0.2s, background 0.2s;
        }

        .manual-entry-grid input:focus {
            outline: none;
            border-color: #fd79a8;
            background: white;
        }

        .manual-entry-grid input::placeholder {
            color: #dfe6e9;
            font-weight: 500;
        }

        .log-now-button {
            flex: 1;
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 15px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(116, 185, 255, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .log-now-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(116, 185, 255, 0.4);
        }

        .log-now-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(116, 185, 255, 0.3);
        }

        details summary {
            cursor: pointer;
            color: #a29bfe;
            font-size: 14px;
            padding: 12px 0;
            user-select: none;
            font-weight: 600;
        }

        details[open] summary {
            margin-bottom: 12px;
        }

        .advanced-inputs {
            display: grid;
            gap: 12px;
        }

        .advanced-inputs input {
            padding: 14px;
            border: 2px solid #ffe5ec;
            border-radius: 15px;
            font-size: 16px;
            background: #fff5f7;
            color: #6c5ce7;
            transition: border-color 0.2s, background 0.2s;
        }

        .advanced-inputs input:focus {
            outline: none;
            border-color: #fd79a8;
            background: white;
        }

        .add-button {
            background: linear-gradient(135deg, #55efc4 0%, #81ecec 100%);
            color: white;
            border: none;
            padding: 16px;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(85, 239, 196, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .add-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(85, 239, 196, 0.4);
        }

        .add-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 10px rgba(85, 239, 196, 0.3);
        }

        .status {
            text-align: center;
            color: #55efc4;
            margin-top: 15px;
            font-size: 14px;
            min-height: 20px;
            font-weight: 700;
        }

        .logs-section {
            background: linear-gradient(135deg, #ffffff 0%, #fef9f9 100%);
            border-radius: 25px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(162, 155, 254, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.8);
        }

        .logs-section details {
            cursor: pointer;
        }

        .logs-section details[open] summary {
            margin-bottom: 20px;
        }

        .logs-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            list-style: none;
            position: relative;
        }

        .logs-header::-webkit-details-marker,
        .logs-header::marker {
            display: none;
        }

        .logs-header::before {
            content: 'â–¼';
            position: absolute;
            left: -5px;
            color: #a29bfe;
            font-size: 14px;
            transition: transform 0.2s;
        }

        details:not([open]) .logs-header::before {
            content: 'â–¶';
        }

        .logs-header h2 {
            font-size: 22px;
            color: #a29bfe;
            margin-left: 15px;
            font-weight: 700;
        }

        .clear-button {
            background: linear-gradient(135deg, #ff7675 0%, #fd79a8 100%);
            color: white;
            border: none;
            padding: 10px 18px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(255, 118, 117, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .clear-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(255, 118, 117, 0.4);
        }

        .clear-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(255, 118, 117, 0.3);
        }

        .log-entry {
            background: linear-gradient(135deg, #fff5f7 0%, #fef9f9 100%);
            padding: 18px;
            border-radius: 18px;
            margin-bottom: 12px;
            border-left: 5px solid #a29bfe;
            box-shadow: 0 3px 10px rgba(162, 155, 254, 0.08);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .log-entry:hover {
            transform: translateX(3px);
            box-shadow: 0 5px 15px rgba(162, 155, 254, 0.15);
        }

        .log-date {
            font-weight: 700;
            color: #a29bfe;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .log-details {
            color: #6c5ce7;
            font-size: 20px;
            font-weight: 700;
        }

        .log-time {
            color: #b2bec3;
            font-size: 13px;
            margin-top: 6px;
            font-weight: 600;
        }

        .empty-state {
            text-align: center;
            color: #dfe6e9;
            padding: 40px 20px;
            font-style: italic;
            font-size: 15px;
        }

        .delete-button {
            float: right;
            background: linear-gradient(135deg, #ffe5ec 0%, #fff0f3 100%);
            color: #fd79a8;
            border: 2px solid #ffccd5;
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .delete-button:hover {
            background: linear-gradient(135deg, #fd79a8 0%, #ff7675 100%);
            color: white;
            border-color: #fd79a8;
            transform: scale(1.05);
        }

        .delete-button:active {
            transform: scale(0.95);
        }

        .stats-section {
            background: linear-gradient(135deg, #ffffff 0%, #fef9f9 100%);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(162, 155, 254, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.8);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-card {
            background: linear-gradient(135deg, #fff5f7 0%, #fef9f9 100%);
            padding: 18px;
            border-radius: 18px;
            text-align: center;
            border: 2px solid #ffe5ec;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(253, 121, 168, 0.15);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #a29bfe 0%, #fd79a8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 11px;
            color: #b2bec3;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        /* Profile Card */
        .profile-section {
            background: linear-gradient(135deg, #ffffff 0%, #fef9f9 100%);
            border-radius: 25px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 25px rgba(162, 155, 254, 0.15);
            border: 3px solid rgba(255, 255, 255, 0.8);
        }

        .profile-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 20px;
            position: relative;
        }

        .profile-toggle {
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #a29bfe 0%, #fd79a8 100%);
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(162, 155, 254, 0.3);
        }

        .profile-toggle:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 6px 16px rgba(162, 155, 254, 0.4);
        }

        .profile-toggle.collapsed::before {
            content: 'â–¶';
        }

        .profile-toggle.expanded::before {
            content: 'â–¼';
        }

        .profile-cards-container {
            max-height: 500px;
            overflow: hidden;
            transition: max-height 0.4s ease-in-out, opacity 0.3s ease-in-out;
            opacity: 1;
        }

        .profile-cards-container.collapsed {
            max-height: 0;
            opacity: 0;
        }

        .profile-hint {
            text-align: center;
            color: #b2bec3;
            font-size: 13px;
            font-weight: 600;
            margin-top: 15px;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
            transition: opacity 0.3s ease-in-out;
        }

        .profile-hint.hidden {
            display: none;
        }

        .profile-name {
            font-size: 28px;
            font-weight: 800;
            background: linear-gradient(135deg, #a29bfe 0%, #fd79a8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
        }

        .profile-emoji {
            font-size: 32px;
        }

        .profile-photo-container {
            cursor: pointer;
            transition: transform 0.2s;
        }

        .profile-photo-container:hover {
            transform: scale(1.05);
        }

        .profile-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #fff5f7 0%, #fef9f9 100%);
            border: 3px solid #fd79a8;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(253, 121, 168, 0.2);
        }

        .profile-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-placeholder {
            font-size: 40px;
        }

        .photo-upload-hint {
            font-size: 10px;
            color: #b2bec3;
            margin-top: 6px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
        }

        @media (max-width: 768px) {
            .profile-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .profile-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        .profile-item {
            background: linear-gradient(135deg, #fff5f7 0%, #fef9f9 100%);
            padding: 16px;
            border-radius: 18px;
            text-align: center;
            border: 2px solid #ffe5ec;
            transition: all 0.2s;
        }

        .profile-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(253, 121, 168, 0.15);
        }

        .profile-label {
            font-size: 11px;
            color: #b2bec3;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .profile-value {
            font-size: 22px;
            font-weight: 800;
            color: #6c5ce7;
            text-align: center;
            line-height: 1.4;
        }

        .profile-value.editable {
            cursor: pointer;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .profile-value.editable:hover {
            color: #a29bfe;
        }

        .profile-value.editable::after {
            content: 'âœï¸';
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.2s;
            display: block;
        }

        .profile-value.editable:hover::after {
            opacity: 1;
        }

        .edit-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #a29bfe;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            color: #6c5ce7;
            text-align: center;
            background: white;
        }

        .edit-input:focus {
            outline: none;
            border-color: #fd79a8;
            box-shadow: 0 0 0 3px rgba(253, 121, 168, 0.1);
        }

        .edit-buttons {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .edit-buttons button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .save-btn {
            background: linear-gradient(135deg, #55efc4 0%, #81ecec 100%);
            color: white;
        }

        .save-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(85, 239, 196, 0.3);
        }

        .cancel-btn {
            background: #f1f3f5;
            color: #636e72;
        }

        .cancel-btn:hover {
            background: #e9ecef;
        }

        .saved-indicator {
            display: inline-block;
            color: #55efc4;
            font-weight: 700;
            font-size: 16px;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .photo-success-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 28px;
            height: 28px;
            background: #55efc4;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            box-shadow: 0 4px 12px rgba(85, 239, 196, 0.4);
            animation: successPop 0.5s ease-out;
        }

        @keyframes successPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Dark Mode - Auto-activates 8pm-6am EST */
        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 50%, #5f4b8b 100%);
            color: #e0e0e0;
        }

        body.dark-mode .main-header,
        body.dark-mode .section-title,
        body.dark-mode h1 {
            color: #e0e0e0;
            text-shadow: 0 3px 10px rgba(0,0,0,0.3);
        }

        body.dark-mode .record-section,
        body.dark-mode .stats-section,
        body.dark-mode .logs-section {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            border: 2px solid #4a5f7f;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode h3 {
            color: #b19cd9;
        }

        body.dark-mode .history-table thead tr {
            background: linear-gradient(135deg, #5f4b8b 0%, #7d5ba6 100%);
        }

        body.dark-mode .history-table tbody tr {
            border-bottom: 2px solid #3d4f63;
        }

        body.dark-mode .history-table tbody tr:hover {
            background: linear-gradient(135deg, #3d4f63 0%, #425566 100%);
        }

        body.dark-mode .history-table tbody td {
            color: #b19cd9;
        }

        body.dark-mode .history-table tbody td:first-child {
            color: #d4a5ff;
        }

        body.dark-mode .history-table .total-ml {
            color: #ff9ff3;
        }

        body.dark-mode .history-table .feed-count {
            color: #a5c9ff;
        }

        body.dark-mode .manual-entry-grid input,
        body.dark-mode .advanced-inputs input {
            background: #3d4f63;
            border-color: #4a5f7f;
            color: #e0e0e0;
        }

        body.dark-mode .manual-entry-grid input:focus,
        body.dark-mode .advanced-inputs input:focus {
            background: #425566;
            border-color: #b19cd9;
        }

        body.dark-mode .manual-entry-grid input::placeholder {
            color: #7f8c9d;
        }

        body.dark-mode details summary {
            color: #b19cd9;
        }

        body.dark-mode .logs-header h2 {
            color: #d4a5ff;
        }

        body.dark-mode .logs-header::before {
            color: #b19cd9;
        }

        body.dark-mode .log-entry {
            background: linear-gradient(135deg, #3d4f63 0%, #425566 100%);
            border-left-color: #b19cd9;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }

        body.dark-mode .log-entry:hover {
            background: linear-gradient(135deg, #425566 0%, #4a5f7f 100%);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .log-date {
            color: #d4a5ff;
        }

        body.dark-mode .log-details {
            color: #e0e0e0;
        }

        body.dark-mode .log-time {
            color: #9ca3af;
        }

        body.dark-mode .empty-state,
        body.dark-mode .history-empty {
            color: #7f8c9d;
        }

        body.dark-mode .stat-card {
            background: linear-gradient(135deg, #3d4f63 0%, #425566 100%);
            border-color: #4a5f7f;
        }

        body.dark-mode .stat-card:hover {
            box-shadow: 0 5px 15px rgba(177, 156, 217, 0.15);
            border-color: #b19cd9;
        }

        body.dark-mode .stat-value {
            background: linear-gradient(135deg, #d4a5ff 0%, #ff9ff3 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.dark-mode .stat-label {
            color: #9ca3af;
        }

        body.dark-mode .cloud > div {
            background: rgba(255, 255, 255, 0.15);
        }

        body.dark-mode .status {
            color: #b19cd9;
        }

        body.dark-mode .profile-section {
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
            border: 2px solid #4a5f7f;
        }

        body.dark-mode .profile-name {
            background: linear-gradient(135deg, #d4a5ff 0%, #ff9ff3 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.dark-mode .profile-photo {
            background: linear-gradient(135deg, #3d4f63 0%, #425566 100%);
            border-color: #b19cd9;
        }

        body.dark-mode .photo-upload-hint {
            color: #7f8c9d;
        }

        body.dark-mode .profile-item {
            background: linear-gradient(135deg, #3d4f63 0%, #425566 100%);
            border-color: #4a5f7f;
        }

        body.dark-mode .profile-value {
            color: #e0e0e0;
        }

        body.dark-mode .profile-value.editable:hover {
            color: #d4a5ff;
        }

        body.dark-mode .edit-input {
            background: #425566;
            border-color: #b19cd9;
            color: #e0e0e0;
        }

        body.dark-mode .cancel-btn {
            background: #3d4f63;
            color: #9ca3af;
        }

        body.dark-mode .cancel-btn:hover {
            background: #4a5f7f;
        }

        body.dark-mode .profile-toggle {
            background: linear-gradient(135deg, #b19cd9 0%, #d4a5ff 100%);
        }

        body.dark-mode .saved-indicator {
            color: #81ecec;
        }

        body.dark-mode .profile-hint {
            color: #7f8c9d;
        }
    </style>
</head>
<body>
    <div class="cloud cloud1">
        <div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="cloud cloud2">
        <div></div><div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="cloud cloud3">
        <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="cloud cloud4">
        <div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="cloud cloud5">
        <div></div><div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="cloud cloud6">
        <div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="cloud cloud7">
        <div></div><div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="cloud cloud8">
        <div></div><div></div><div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="cloud cloud9">
        <div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="cloud cloud10">
        <div></div><div></div><div></div><div></div><div></div><div></div>
    </div>
    
    <div class="container">
        <h1 class="main-header">Baby Dashboard</h1>

        <div class="profile-section">
            <div class="profile-header">
                <div class="profile-photo-container" onclick="uploadPhoto()">
                    <div class="profile-photo" id="profilePhoto">
                        <span class="photo-placeholder">ðŸ‘¶</span>
                    </div>
                    <div class="photo-upload-hint">Click to upload</div>
                </div>
                <h2 class="profile-name">Serafina</h2>
                <button class="profile-toggle collapsed" onclick="toggleProfileCards()" aria-label="Toggle profile details"></button>
            </div>
            <div class="profile-hint" id="profileHint">Click â–¶ to view profile details</div>
            <div class="profile-cards-container collapsed" id="profileCards">
                <div class="profile-grid">
                    <div class="profile-item">
                        <div class="profile-label">Age</div>
                        <div class="profile-value" id="babyAge">--</div>
                    </div>
                    <div class="profile-item">
                        <div class="profile-label">Birth Date</div>
                        <div class="profile-value">Dec 3, 2025</div>
                    </div>
                    <div class="profile-item">
                        <div class="profile-label">Height</div>
                        <div class="profile-value editable" id="babyHeight" onclick="editField('height')">23.5 in</div>
                    </div>
                    <div class="profile-item">
                        <div class="profile-label">Weight</div>
                        <div class="profile-value editable" id="babyWeight" onclick="editField('weight')">12 lbs</div>
                    </div>
                    <div class="profile-item">
                        <div class="profile-label">Last Doctor Visit</div>
                        <div class="profile-value editable" id="lastVisit" onclick="editField('lastVisit')">Not set</div>
                    </div>
                    <div class="profile-item">
                        <div class="profile-label">Next Doctor Visit</div>
                        <div class="profile-value editable" id="nextVisit" onclick="editField('nextVisit')">Not set</div>
                    </div>
                </div>
            </div>
        </div>

        <input type="file" id="photoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">

        <h2 class="section-title">Bottle Feed Tracker</h2>

        <div class="stats-section" id="statsSection">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="todayCount">0</div>
                    <div class="stat-label">Today's Feeds</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="todayTotal">0ml</div>
                    <div class="stat-label">Today's Total</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="lastFeed">--</div>
                    <div class="stat-label">Last Feed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="timeSince">--</div>
                    <div class="stat-label">Time Since Last</div>
                </div>
            </div>
        </div>
        
        <div class="record-section">
            <h3>Last 6 Days</h3>
            <table class="history-table">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Feeds</th>
                        <th>Total (ml)</th>
                    </tr>
                </thead>
                <tbody id="historyTableBody">
                    <tr><td colspan="3" class="history-empty">Loading...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="record-section">
            <h3>Manual Entry</h3>
            
            <div class="manual-entry-grid">
                <input type="number" id="manualAmount" placeholder="Amount (ml)" inputmode="numeric">
                <button class="log-now-button" onclick="addQuickEntry()">Log Now</button>
            </div>

            <details>
                <summary>Advanced: Edit Date/Time</summary>
                <div class="advanced-inputs">
                    <input type="date" id="manualDate">
                    <input type="time" id="manualTime">
                    <button class="add-button" onclick="addManualEntry()">Add with Custom Date/Time</button>
                </div>
            </details>

            <div class="status" id="status"></div>
        </div>

        <div class="logs-section">
            <details>
                <summary class="logs-header">
                    <h2>Feed Log</h2>
                    <button class="clear-button" onclick="clearAllLogs()">Clear All</button>
                </summary>
                <div id="logsList"></div>
            </details>
        </div>
    </div>

    <script>
        // Google Sheets API endpoint
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxpvWLPSczZFjlEpizpy85diLRQXrq3fag0388Glhma3VZiNDIjJBJjeD3AYXrhl2Ws/exec';
        
        // Check for incoming data from iOS Shortcut
        window.addEventListener('load', function() {
            // Check hash fragment (e.g., #voice=120ml)
            const hash = window.location.hash.substring(1); // Remove the #
            const hashParams = new URLSearchParams(hash);
            const voiceFromHash = hashParams.get('voice');
            
            // Check URL parameters (multiple possible parameter names)
            const urlParams = new URLSearchParams(window.location.search);
            const voiceFromURL = urlParams.get('voice');
            const voiceFromTrigger = urlParams.get('trigger');
            
            const voiceInput = voiceFromHash || voiceFromURL || voiceFromTrigger;

            if (voiceInput) {
                // Decode URL encoding if present
                const decodedInput = decodeURIComponent(voiceInput);
                
                // Parse the voice input
                const parsed = parseVoiceInput(decodedInput);
                if (parsed.amount) {
                    saveEntry(parsed);
                    showStatus(`âœ“ Logged ${parsed.amount}ml from voice: "${decodedInput}"`);
                } else {
                    showStatus(`âŒ Could not parse amount from: "${decodedInput}"`);
                }
                
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
            } else {
                // Just loading the app - fetch existing data
                displayLogs();
                updateStats();
                buildHistoryTable();
            }
        });

        function parseVoiceInput(text) {
            // Get current time in EST properly
            const now = new Date();
            const estFormatter = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
            
            const parts = estFormatter.formatToParts(now);
            const year = parts.find(p => p.type === 'year').value;
            const month = parts.find(p => p.type === 'month').value;
            const day = parts.find(p => p.type === 'day').value;
            const hour = parts.find(p => p.type === 'hour').value;
            const minute = parts.find(p => p.type === 'minute').value;
            
            let date = `${year}-${month}-${day}`;
            let time = `${hour}:${minute}`;
            let amount = null;

            text = text.toLowerCase();

            // Parse amount (ml, milliliters, etc.)
            const amountPatterns = [
                /(\d+)\s*(ml|milliliters?|mls)/i,
                /(\d+)\s*ounces?/i,
                /(\d+)\s*oz/i
            ];

            for (const pattern of amountPatterns) {
                const match = text.match(pattern);
                if (match) {
                    amount = parseInt(match[1]);
                    // Convert ounces to ml if needed
                    if (match[2] && (match[2].toLowerCase().includes('oz') || match[2].toLowerCase().includes('ounce'))) {
                        amount = Math.round(amount * 29.5735);
                    }
                    break;
                }
            }

            // If no explicit unit, try to extract any number (assume ml)
            if (!amount) {
                const numberMatch = text.match(/(\d+)/);
                if (numberMatch) {
                    amount = parseInt(numberMatch[1]);
                }
            }

            // Parse relative dates
            if (text.includes('yesterday')) {
                const yesterday = new Date(now);
                yesterday.setDate(yesterday.getDate() - 1);
                date = yesterday.toISOString().split('T')[0];
            } else if (text.includes('today')) {
                date = now.toISOString().split('T')[0];
            } else if (text.includes('tomorrow')) {
                const tomorrow = new Date(now);
                tomorrow.setDate(tomorrow.getDate() + 1);
                date = tomorrow.toISOString().split('T')[0];
            }

            // Parse specific dates (e.g., "February 10th", "Feb 10", "2/10")
            const monthNames = ['january', 'february', 'march', 'april', 'may', 'june', 
                              'july', 'august', 'september', 'october', 'november', 'december'];
            const monthAbbrev = ['jan', 'feb', 'mar', 'apr', 'may', 'jun', 
                               'jul', 'aug', 'sep', 'oct', 'nov', 'dec'];
            
            // Match "February 10th" or "Feb 10"
            for (let i = 0; i < monthNames.length; i++) {
                const fullPattern = new RegExp(`${monthNames[i]}\\s+(\\d{1,2})(?:st|nd|rd|th)?`, 'i');
                const abbrPattern = new RegExp(`${monthAbbrev[i]}\\s+(\\d{1,2})(?:st|nd|rd|th)?`, 'i');
                
                let match = text.match(fullPattern) || text.match(abbrPattern);
                if (match) {
                    const day = parseInt(match[1]);
                    const year = now.getFullYear();
                    const month = (i + 1).toString().padStart(2, '0');
                    const dayStr = day.toString().padStart(2, '0');
                    date = `${year}-${month}-${dayStr}`;
                    break;
                }
            }

            // Match "2/10" or "02/10" format
            const slashDateMatch = text.match(/(\d{1,2})\/(\d{1,2})/);
            if (slashDateMatch) {
                const month = parseInt(slashDateMatch[1]).toString().padStart(2, '0');
                const day = parseInt(slashDateMatch[2]).toString().padStart(2, '0');
                const year = now.getFullYear();
                date = `${year}-${month}-${day}`;
            }

            // Parse time patterns - try multiple approaches
            let timeFound = false;
            
            // Pattern 1: "at 3pm", "at 3:30pm", "at 3 pm"
            let match = text.match(/at\s+(\d{1,2}):?(\d{2})?\s*(am|pm|a\.m\.|p\.m\.)?/i);
            if (match) {
                let hours = parseInt(match[1]);
                let minutes = match[2] ? parseInt(match[2]) : 0;
                const period = match[3];

                if (period) {
                    const periodLower = period.toLowerCase().replace(/\./g, '');
                    if (periodLower === 'pm' && hours < 12) {
                        hours += 12;
                    } else if (periodLower === 'am' && hours === 12) {
                        hours = 0;
                    }
                }

                time = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                timeFound = true;
            }

            // Pattern 2: "3:30pm", "15:30" (without "at")
            if (!timeFound) {
                match = text.match(/(\d{1,2}):(\d{2})\s*(am|pm|a\.m\.|p\.m\.)?/i);
                if (match) {
                    let hours = parseInt(match[1]);
                    let minutes = parseInt(match[2]);
                    const period = match[3];

                    if (period) {
                        const periodLower = period.toLowerCase().replace(/\./g, '');
                        if (periodLower === 'pm' && hours < 12) {
                            hours += 12;
                        } else if (periodLower === 'am' && hours === 12) {
                            hours = 0;
                        }
                    }

                    time = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
                    timeFound = true;
                }
            }

            // Pattern 3: "3pm", "3 pm" (just hour, no minutes)
            if (!timeFound) {
                match = text.match(/(?:^|\s)(\d{1,2})\s*(am|pm|a\.m\.|p\.m\.)(?:\s|$)/i);
                if (match) {
                    let hours = parseInt(match[1]);
                    const period = match[2];

                    const periodLower = period.toLowerCase().replace(/\./g, '');
                    if (periodLower === 'pm' && hours < 12) {
                        hours += 12;
                    } else if (periodLower === 'am' && hours === 12) {
                        hours = 0;
                    }

                    time = `${hours.toString().padStart(2, '0')}:00`;
                    timeFound = true;
                }
            }

            // Check for "now" keyword
            if (text.includes('now') || text.includes('just now')) {
                time = `${hour}:${minute}`;
            }

            console.log('Parsed voice input:', { text, date, time, amount, timeFound });

            return { date, time, amount };
        }

        async function buildHistoryTable() {
            const logs = await getLogs();
            const tbody = document.getElementById('historyTableBody');

            // Get EST formatter
            const now = new Date();
            const estFormatter = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });

            const parts = estFormatter.formatToParts(now);
            const year = parseInt(parts.find(p => p.type === 'year').value);
            const month = parseInt(parts.find(p => p.type === 'month').value);
            const day = parseInt(parts.find(p => p.type === 'day').value);
            const currentHour = parseInt(parts.find(p => p.type === 'hour').value);

            // Calculate the start of the CURRENT 6am-6am window
            let currentWindowStart;
            if (currentHour < 6) {
                currentWindowStart = new Date(year, month - 1, day - 1, 6, 0, 0, 0);
            } else {
                currentWindowStart = new Date(year, month - 1, day, 6, 0, 0, 0);
            }

            // Build 6 previous day windows (going back from the day before current)
            const rows = [];
            for (let i = 1; i <= 6; i++) {
                const windowEnd = new Date(currentWindowStart);
                windowEnd.setDate(windowEnd.getDate() - (i - 1));
                const windowStart = new Date(windowEnd);
                windowStart.setDate(windowStart.getDate() - 1);

                // Filter logs in this window
                const windowLogs = logs.filter(log => {
                    const dateStr = log.date;
                    const timeStr = log.time;

                    let logDate = (dateStr instanceof Date) ? dateStr : new Date(dateStr);
                    if (isNaN(logDate.getTime())) return false;

                    const timeParts = timeStr.toString().replace(/'/g, '').trim().split(':');
                    const logHours = parseInt(timeParts[0]);
                    const logMinutes = parseInt(timeParts[1]) || 0;

                    const logDateTime = new Date(
                        logDate.getFullYear(),
                        logDate.getMonth(),
                        logDate.getDate(),
                        logHours,
                        logMinutes
                    );

                    return logDateTime >= windowStart && logDateTime < windowEnd;
                });

                const totalMl = windowLogs.reduce((sum, log) => sum + parseInt(log.amount), 0);
                const feedCount = windowLogs.length;

                // Label the window by its start date
                const label = windowStart.toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });

                rows.push({ label, feedCount, totalMl });
            }

            if (rows.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" class="history-empty">No history yet</td></tr>';
                return;
            }

            tbody.innerHTML = rows.map(row => `
                <tr>
                    <td>${row.label}</td>
                    <td class="feed-count">${row.feedCount}</td>
                    <td class="total-ml">${row.totalMl > 0 ? formatAmount(row.totalMl) : '--'}</td>
                </tr>
            `).join('');
        }

        function addQuickEntry() {
            const amount = parseInt(document.getElementById('manualAmount').value);

            if (!amount) {
                alert('Please enter an amount');
                return;
            }

            // Get current time in EST properly
            const now = new Date();
            const estFormatter = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
            
            const parts = estFormatter.formatToParts(now);
            const year = parts.find(p => p.type === 'year').value;
            const month = parts.find(p => p.type === 'month').value;
            const day = parts.find(p => p.type === 'day').value;
            const hour = parts.find(p => p.type === 'hour').value;
            const minute = parts.find(p => p.type === 'minute').value;
            
            const date = `${year}-${month}-${day}`;
            const time = `${hour}:${minute}`;

            saveEntry({ date, time, amount });
            document.getElementById('manualAmount').value = '';
            showStatus(`âœ“ Logged ${amount}ml`);
        }

        function addManualEntry() {
            const date = document.getElementById('manualDate').value;
            const time = document.getElementById('manualTime').value;
            const amount = parseInt(document.getElementById('manualAmount').value);

            if (!date || !time || !amount) {
                alert('Please fill in all fields');
                return;
            }

            saveEntry({ date, time, amount });
            
            document.getElementById('manualDate').value = '';
            document.getElementById('manualTime').value = '';
            document.getElementById('manualAmount').value = '';
            
            showStatus(`âœ“ Manual entry saved!`);
        }

        function saveEntry(entry) {
            // Add to Google Sheets
            const data = {
                action: 'add',
                date: entry.date,
                time: entry.time,
                amount: entry.amount
            };
            
            fetch(GOOGLE_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            }).then(() => {
                // Refresh the display after saving
                setTimeout(() => {
                    displayLogs();
                    updateStats();
                    buildHistoryTable();
                }, 1000);
            }).catch(error => {
                console.error('Error saving entry:', error);
                showStatus('âŒ Error saving feed');
            });
        }

        async function getLogs() {
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL);
                const data = await response.json();
                
                if (data.success && data.feeds) {
                    // Sort by timestamp descending (newest first)
                    return data.feeds.sort((a, b) => {
                        return new Date(b.timestamp) - new Date(a.timestamp);
                    });
                }
                return [];
            } catch (error) {
                console.error('Error fetching logs:', error);
                return [];
            }
        }

        async function displayLogs() {
            const logs = await getLogs();
            const logsList = document.getElementById('logsList');
            
            console.log('Displaying logs:', logs);

            if (logs.length === 0) {
                logsList.innerHTML = '<div class="empty-state">No feeds logged yet</div>';
                return;
            }

            // Sort logs by date/time - most recent first
            const sortedLogs = logs.sort((a, b) => {
                // Parse dates and times
                const dateA = new Date(a.date);
                const dateB = new Date(b.date);
                
                // Extract hours and minutes from time strings
                const timePartsA = a.time.toString().replace(/'/g, '').trim().split(':');
                const timePartsB = b.time.toString().replace(/'/g, '').trim().split(':');
                
                const hoursA = parseInt(timePartsA[0]);
                const minutesA = parseInt(timePartsA[1]) || 0;
                const hoursB = parseInt(timePartsB[0]);
                const minutesB = parseInt(timePartsB[1]) || 0;
                
                // Create full datetime objects
                const fullDateA = new Date(dateA.getFullYear(), dateA.getMonth(), dateA.getDate(), hoursA, minutesA);
                const fullDateB = new Date(dateB.getFullYear(), dateB.getMonth(), dateB.getDate(), hoursB, minutesB);
                
                // Sort descending (most recent first)
                return fullDateB - fullDateA;
            });

            logsList.innerHTML = sortedLogs.map((log, index) => {
                console.log('Formatting log:', log);
                const formattedDate = formatDate(log.date);
                const formattedTime = formatTime(log.time);
                console.log('Formatted:', { date: formattedDate, time: formattedTime });
                
                return `
                    <div class="log-entry">
                        <button class="delete-button" onclick="deleteEntry('${log.timestamp}')">Delete</button>
                        <div class="log-date">${formattedDate}</div>
                        <div class="log-details">${formatAmount(log.amount)}</div>
                        <div class="log-time">Time: ${formattedTime}</div>
                    </div>
                `;
            }).join('');
        }

        function deleteEntry(timestamp) {
            if (confirm('Delete this entry?')) {
                const data = {
                    action: 'delete',
                    timestamp: timestamp
                };
                
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                }).then(() => {
                    setTimeout(() => {
                        displayLogs();
                        updateStats();
                        buildHistoryTable();
                    }, 1000);
                }).catch(error => {
                    console.error('Error deleting entry:', error);
                });
            }
        }

        async function clearAllLogs() {
            if (confirm('Are you sure you want to clear all logs? This will delete data for both you and your wife!')) {
                const logs = await getLogs();
                
                // Delete all entries
                for (const log of logs) {
                    const data = {
                        action: 'delete',
                        timestamp: log.timestamp
                    };
                    
                    await fetch(GOOGLE_SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                }
                
                setTimeout(() => {
                    displayLogs();
                    updateStats();
                    buildHistoryTable();
                }, 1000);
            }
        }

        async function updateStats() {
            const logs = await getLogs();
            
            // Get current time in EST properly
            const now = new Date();
            const estFormatter = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            });
            
            const parts = estFormatter.formatToParts(now);
            const year = parseInt(parts.find(p => p.type === 'year').value);
            const month = parseInt(parts.find(p => p.type === 'month').value);
            const day = parseInt(parts.find(p => p.type === 'day').value);
            const currentHour = parseInt(parts.find(p => p.type === 'hour').value);
            const currentMinute = parseInt(parts.find(p => p.type === 'minute').value);
            
            // Create EST Date object for current time
            const estNow = new Date(year, month - 1, day, currentHour, currentMinute);
            
            // Determine the current "day" window (6am EST to 6am EST)
            let currentDayStart;
            if (currentHour < 6) {
                // Before 6am - use yesterday at 6am
                currentDayStart = new Date(year, month - 1, day - 1, 6, 0, 0, 0);
            } else {
                // After 6am - use today at 6am
                currentDayStart = new Date(year, month - 1, day, 6, 0, 0, 0);
            }
            
            const currentDayEnd = new Date(currentDayStart);
            currentDayEnd.setDate(currentDayEnd.getDate() + 1);
            
            console.log('Current time (EST):', estNow);
            console.log('Current day range (6am-6am EST):', currentDayStart, 'to', currentDayEnd);
            console.log('Logs:', logs);
            
            // Filter logs within the current 6am-6am window
            const todayLogs = logs.filter(log => {
                console.log('Processing log:', log);
                
                // Parse log date and time
                const dateStr = log.date;
                const timeStr = log.time;
                
                console.log('Date string:', dateStr, 'Type:', typeof dateStr);
                console.log('Time string:', timeStr, 'Type:', typeof timeStr);
                
                // Parse date - handle full GMT string or YYYY-MM-DD
                let logDate;
                if (dateStr instanceof Date) {
                    logDate = dateStr;
                } else if (typeof dateStr === 'string') {
                    // Parse the date string (handles both "Sun Feb 15 2026..." and "2026-02-15")
                    logDate = new Date(dateStr);
                }
                
                if (!logDate || isNaN(logDate.getTime())) {
                    console.error('Cannot parse date:', dateStr);
                    return false;
                }
                
                const logYear = logDate.getFullYear();
                const logMonth = logDate.getMonth();
                const logDay = logDate.getDate();
                
                // Parse time (HH:MM format, may have seconds or apostrophe)
                let timeString = timeStr.toString().replace(/'/g, '').trim();
                // Remove seconds if present (13:00:00 -> 13:00)
                const timeParts = timeString.split(':');
                const logHours = parseInt(timeParts[0]);
                const logMinutes = parseInt(timeParts[1]) || 0;
                
                console.log('Parsed:', {logYear, logMonth, logDay, logHours, logMinutes});
                
                // Create datetime object
                const logDateTime = new Date(logYear, logMonth, logDay, logHours, logMinutes);
                
                console.log('Log datetime:', logDateTime);
                console.log('Current day start:', currentDayStart);
                console.log('Current day end:', currentDayEnd);
                
                const isInRange = logDateTime >= currentDayStart && logDateTime < currentDayEnd;
                console.log('In range?', isInRange);
                return isInRange;
            });
            
            console.log('Today\'s logs (6am-6am):', todayLogs);

            // Today's count
            document.getElementById('todayCount').textContent = todayLogs.length;

            // Today's total (with ounces conversion)
            const todayTotal = todayLogs.reduce((sum, log) => sum + parseInt(log.amount), 0);
            document.getElementById('todayTotal').textContent = formatAmount(todayTotal);

            // Last feed time and time since last feed - ALWAYS USE MOST RECENT CHRONOLOGICALLY
            if (logs.length > 0) {
                // Sort all logs chronologically to find the most recent one
                const sortedLogs = logs.sort((a, b) => {
                    // Parse dates and times for both logs
                    const dateA = new Date(a.date);
                    const dateB = new Date(b.date);
                    
                    const timePartsA = a.time.toString().replace(/'/g, '').trim().split(':');
                    const timePartsB = b.time.toString().replace(/'/g, '').trim().split(':');
                    
                    const hoursA = parseInt(timePartsA[0]);
                    const minutesA = parseInt(timePartsA[1]) || 0;
                    const hoursB = parseInt(timePartsB[0]);
                    const minutesB = parseInt(timePartsB[1]) || 0;
                    
                    // Create full datetime objects
                    const fullDateA = new Date(dateA.getFullYear(), dateA.getMonth(), dateA.getDate(), hoursA, minutesA);
                    const fullDateB = new Date(dateB.getFullYear(), dateB.getMonth(), dateB.getDate(), hoursB, minutesB);
                    
                    // Sort descending (most recent first)
                    return fullDateB - fullDateA;
                });
                
                // Now the first item is guaranteed to be the most recent
                const lastLog = sortedLogs[0];
                const lastTime = formatTime(lastLog.time);
                document.getElementById('lastFeed').textContent = lastTime;
                
                // Calculate time since last feed using EST
                const dateStr = lastLog.date;
                const timeStr = lastLog.time;
                
                console.log('Last log date:', dateStr, 'time:', timeStr);
                
                // Parse date - handle full GMT string
                let logDate;
                if (dateStr instanceof Date) {
                    logDate = dateStr;
                } else if (typeof dateStr === 'string') {
                    logDate = new Date(dateStr);
                }
                
                if (!logDate || isNaN(logDate.getTime())) {
                    console.error('Cannot parse last feed date:', dateStr);
                    document.getElementById('timeSince').textContent = '--';
                } else {
                    const logYear = logDate.getFullYear();
                    const logMonth = logDate.getMonth();
                    const logDay = logDate.getDate();
                    
                    // Parse time - handle HH:MM or HH:MM:SS
                    const timeParts = timeStr.toString().replace(/'/g, '').trim().split(':');
                    const logHours = parseInt(timeParts[0]);
                    const logMinutes = parseInt(timeParts[1]) || 0;
                    
                    const lastFeedDate = new Date(logYear, logMonth, logDay, logHours, logMinutes);
                    
                    console.log('Last feed date:', lastFeedDate, 'Now (EST):', estNow);
                    
                    const diffMs = estNow - lastFeedDate;
                    const diffMins = Math.floor(diffMs / 60000);
                    const hoursAgo = Math.floor(diffMins / 60);
                    const minutesAgo = diffMins % 60;
                    
                    console.log('Time diff:', hoursAgo, 'hours', minutesAgo, 'minutes');
                    
                    if (hoursAgo > 0) {
                        document.getElementById('timeSince').textContent = `${hoursAgo}h ${minutesAgo}m`;
                    } else {
                        document.getElementById('timeSince').textContent = `${minutesAgo}m`;
                    }
                }
            } else {
                document.getElementById('lastFeed').textContent = '--';
                document.getElementById('timeSince').textContent = '--';
            }

            // Average amount - removed, keeping for reference
            // if (logs.length > 0) {
            //     const avgAmount = Math.round(logs.reduce((sum, log) => sum + parseInt(log.amount), 0) / logs.length);
            //     document.getElementById('avgAmount').textContent = avgAmount + 'ml';
            // } else {
            //     document.getElementById('avgAmount').textContent = '0ml';
            // }
        }

        function showStatus(message) {
            document.getElementById('status').textContent = message;
            setTimeout(() => {
                document.getElementById('status').textContent = '';
            }, 2000);
        }

        function formatDate(dateString) {
            // Handle both ISO format (2026-02-15) and Date objects
            if (!dateString) return 'Invalid Date';
            
            let date;
            if (typeof dateString === 'string') {
                // Parse YYYY-MM-DD format
                const parts = dateString.split('-');
                if (parts.length === 3) {
                    date = new Date(parseInt(parts[0]), parseInt(parts[1]) - 1, parseInt(parts[2]));
                } else {
                    date = new Date(dateString);
                }
            } else {
                date = new Date(dateString);
            }
            
            if (isNaN(date.getTime())) return 'Invalid Date';
            
            return date.toLocaleDateString('en-US', { 
                weekday: 'short', 
                month: 'short', 
                day: 'numeric',
                year: 'numeric'
            });
        }

        function formatTime(timeString) {
            // Handle various time formats from Google Sheets
            if (!timeString) return 'Invalid Time';
            
            let hours, minutes;
            
            // Handle HH:MM or H:MM format
            if (typeof timeString === 'string' && timeString.includes(':')) {
                const parts = timeString.split(':');
                hours = parseInt(parts[0]);
                minutes = parseInt(parts[1]);
            } else {
                return 'Invalid Time';
            }
            
            if (isNaN(hours) || isNaN(minutes)) return 'Invalid Time';
            
            const period = hours >= 12 ? 'PM' : 'AM';
            const displayHour = hours === 0 ? 12 : hours > 12 ? hours - 12 : hours;
            return `${displayHour}:${minutes.toString().padStart(2, '0')} ${period}`;
        }

        function mlToOz(ml) {
            // Convert milliliters to ounces (1 ml = 0.033814 oz)
            const oz = ml * 0.033814;
            // Round to 1 decimal place, but only show decimal if needed
            const rounded = Math.round(oz * 10) / 10;
            return rounded % 1 === 0 ? rounded.toFixed(0) : rounded.toFixed(1);
        }

        function formatAmount(ml) {
            // Format as "XXml (X.Xoz)" or "XXml (Xoz)" if whole number
            return `${ml}ml (${mlToOz(ml)}oz)`;
        }

        function setDefaultDateTime() {
            const now = new Date();
            document.getElementById('manualDate').value = now.toISOString().split('T')[0];
            document.getElementById('manualTime').value = now.toTimeString().split(' ')[0].substring(0, 5);
        }

        // Profile Management
        const BABY_BIRTHDAY = new Date('2025-12-03');
        let profileData = {
            height: 23.5, // inches
            weight: 12,   // lbs
            photo: null,  // base64 image data
            lastVisit: null,  // date string
            nextVisit: null   // date string
        };

        // Toggle profile cards collapse/expand
        function toggleProfileCards() {
            const container = document.getElementById('profileCards');
            const button = document.querySelector('.profile-toggle');
            const hint = document.getElementById('profileHint');
            
            if (container.classList.contains('collapsed')) {
                // Expanding
                container.classList.remove('collapsed');
                button.classList.remove('collapsed');
                button.classList.add('expanded');
                hint.classList.add('hidden');
            } else {
                // Collapsing
                container.classList.add('collapsed');
                button.classList.remove('expanded');
                button.classList.add('collapsed');
                hint.classList.remove('hidden');
            }
        }

        function calculateAge() {
            const now = new Date();
            const diffTime = Math.abs(now - BABY_BIRTHDAY);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            const weeks = Math.round(diffDays / 7);
            
            let mainDisplay = '';
            
            if (diffDays < 365) {
                // Under 1 year - show months only
                const months = Math.round(diffDays / 30);
                if (months === 0) {
                    mainDisplay = '0mo';
                } else if (months === 1) {
                    mainDisplay = '1mo';
                } else {
                    mainDisplay = `${months}mo`;
                }
            } else {
                // 1 year or older - show years and months
                const years = Math.floor(diffDays / 365);
                const remainingDays = diffDays % 365;
                const months = Math.round(remainingDays / 30);
                
                if (months === 0) {
                    mainDisplay = `${years}yr`;
                } else {
                    mainDisplay = `${years}yr ${months}mo`;
                }
            }
            
            // Return with weeks in parentheses on new line
            return `${mainDisplay}<br><span style="font-size: 14px; color: #b2bec3;">(${weeks}w)</span>`;
        }

        function updateAge() {
            document.getElementById('babyAge').innerHTML = calculateAge();
        }

        function loadProfileData() {
            const saved = localStorage.getItem('serafina_profile');
            if (saved) {
                profileData = JSON.parse(saved);
                document.getElementById('babyHeight').textContent = `${profileData.height} in`;
                document.getElementById('babyWeight').textContent = `${profileData.weight} lbs`;
                
                // Load photo
                if (profileData.photo) {
                    document.getElementById('profilePhoto').innerHTML = `<img src="${profileData.photo}" alt="Serafina">`;
                }
                
                // Load doctor visits
                if (profileData.lastVisit) {
                    document.getElementById('lastVisit').textContent = formatVisitDate(profileData.lastVisit);
                }
                if (profileData.nextVisit) {
                    document.getElementById('nextVisit').textContent = formatVisitDate(profileData.nextVisit);
                }
            }
            updateAge();
        }

        function formatVisitDate(dateStr) {
            if (!dateStr) return 'Not set';
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function saveProfileData() {
            localStorage.setItem('serafina_profile', JSON.stringify(profileData));
        }

        function editField(fieldName) {
            let element, currentValue, inputType, inputStep;
            
            if (fieldName === 'height') {
                element = document.getElementById('babyHeight');
                currentValue = profileData.height;
                inputType = 'number';
                inputStep = '0.1';
            } else if (fieldName === 'weight') {
                element = document.getElementById('babyWeight');
                currentValue = profileData.weight;
                inputType = 'number';
                inputStep = '0.1';
            } else if (fieldName === 'lastVisit' || fieldName === 'nextVisit') {
                element = document.getElementById(fieldName);
                currentValue = profileData[fieldName] || '';
                inputType = 'date';
                inputStep = null;
            }
            
            const stepAttr = inputStep ? `step="${inputStep}"` : '';
            
            element.innerHTML = `
                <input type="${inputType}" ${stepAttr} class="edit-input" id="edit-${fieldName}" value="${currentValue}" />
                <div class="edit-buttons">
                    <button class="save-btn" onclick="saveField('${fieldName}')">Save</button>
                    <button class="cancel-btn" onclick="cancelEdit('${fieldName}')">Cancel</button>
                </div>
            `;
            
            document.getElementById(`edit-${fieldName}`).focus();
            if (inputType === 'number') {
                document.getElementById(`edit-${fieldName}`).select();
            }
        }

        function saveField(fieldName) {
            const input = document.getElementById(`edit-${fieldName}`);
            let newValue, element, displayText;
            
            if (fieldName === 'height' || fieldName === 'weight') {
                newValue = parseFloat(input.value);
                
                if (isNaN(newValue) || newValue <= 0) {
                    alert('Please enter a valid number');
                    return;
                }
                
                profileData[fieldName] = newValue;
                element = document.getElementById(fieldName === 'height' ? 'babyHeight' : 'babyWeight');
                const unit = fieldName === 'height' ? 'in' : 'lbs';
                displayText = `${newValue} ${unit}`;
            } else if (fieldName === 'lastVisit' || fieldName === 'nextVisit') {
                newValue = input.value;
                
                if (!newValue) {
                    profileData[fieldName] = null;
                    displayText = 'Not set';
                } else {
                    profileData[fieldName] = newValue;
                    displayText = formatVisitDate(newValue);
                }
                
                element = document.getElementById(fieldName);
            }
            
            saveProfileData();
            
            // Show "Saved âœ…" indicator
            element.innerHTML = '<span class="saved-indicator">Saved âœ…</span>';
            
            // After 2 seconds, show the actual value and restore edit functionality
            setTimeout(() => {
                element.textContent = displayText;
                element.onclick = () => editField(fieldName);
            }, 2000);
        }

        function cancelEdit(fieldName) {
            let element, displayText;
            
            if (fieldName === 'height') {
                element = document.getElementById('babyHeight');
                displayText = `${profileData.height} in`;
            } else if (fieldName === 'weight') {
                element = document.getElementById('babyWeight');
                displayText = `${profileData.weight} lbs`;
            } else if (fieldName === 'lastVisit' || fieldName === 'nextVisit') {
                element = document.getElementById(fieldName);
                displayText = profileData[fieldName] ? formatVisitDate(profileData[fieldName]) : 'Not set';
            }
            
            element.textContent = displayText;
            element.onclick = () => editField(fieldName);
        }

        // Photo Upload Functions
        function uploadPhoto() {
            document.getElementById('photoInput').click();
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check file size (limit to 5MB for localStorage)
            if (file.size > 5 * 1024 * 1024) {
                alert('Photo is too large. Please choose a photo under 5MB.');
                return;
            }
            
            // Check if it's an image
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file.');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Image = e.target.result;
                
                // Save to profile data
                profileData.photo = base64Image;
                saveProfileData();
                
                // Display the image
                const photoContainer = document.getElementById('profilePhoto');
                photoContainer.innerHTML = `<img src="${base64Image}" alt="Serafina">`;
                
                // Show success badge
                const badge = document.createElement('div');
                badge.className = 'photo-success-badge';
                badge.textContent = 'âœ…';
                photoContainer.parentElement.style.position = 'relative';
                photoContainer.parentElement.appendChild(badge);
                
                // Remove badge after 2 seconds
                setTimeout(() => {
                    badge.remove();
                }, 2000);
            };
            
            reader.onerror = function() {
                alert('Error uploading photo. Please try again.');
            };
            
            reader.readAsDataURL(file);
        }

        // Auto Dark Mode (8pm - 6am EST)
        function checkDarkMode() {
            const now = new Date();
            const estFormatter = new Intl.DateTimeFormat('en-US', {
                timeZone: 'America/New_York',
                hour: '2-digit',
                hour12: false
            });
            
            const parts = estFormatter.formatToParts(now);
            const currentHour = parseInt(parts.find(p => p.type === 'hour').value);
            
            // Enable dark mode from 8pm (20:00) to 6am (06:00)
            if (currentHour >= 20 || currentHour < 6) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        // Initialize
        checkDarkMode();
        loadProfileData();
        setDefaultDateTime();
        displayLogs();
        updateStats();
        buildHistoryTable();
        
        // Check dark mode every minute
        setInterval(checkDarkMode, 60000);
        
        // Update age every hour
        setInterval(updateAge, 3600000);
    </script>
</body>
</html>
